(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{5493:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return E}});var r=n(6687),a=n(29),i=n(7794),c=n.n(i),o=n(8557),s=n(1163),u=n(6257),l=n(7294),f=n(120),d=n(1448),p=n(9630),h=n(7132);function x(){return(x=(0,a.Z)(c().mark(function e(t,n){var r,a,i;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return r=e.sent,e.t0=window.URL,e.next=6,r.blob();case 6:e.t1=e.sent,console.log(a=e.t0.createObjectURL.call(e.t0,e.t1)),(i=document.createElement("a")).style.display="none",i.href=a,i.download=n,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(a);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}var m=n(5893);function b(e){var t=e.msg;return(0,m.jsxs)(f.Z,{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:.5,children:[(0,m.jsx)(d.Z,{sx:{height:"100%"},label:(0,m.jsx)(p.Z,{whiteSpace:"pre-line",py:.79,fontSize:"0.8125rem",children:t.text})}),t.files.map(function(e,t){var n=decodeURIComponent(e.split("%2F").at(-1));return(0,m.jsx)(d.Z,{icon:(0,m.jsx)(h.Z,{}),label:n,onClick:function(){return function(e,t){return x.apply(this,arguments)}(e,n)}},t)})]})}var g=n(6336),j=n(8377),w=n(9722),y=n(8481),Z=n(4412),v=n(9442),k=n(562),_=n(594);function R(e){var t,n=e.id,i=e.inputBoxRef,o=(0,l.useState)([]),s=o[0],u=o[1],p=(0,l.useState)(""),x=p[0],b=p[1],j=(t=(0,a.Z)(c().mark(function e(t){var r,a;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new FormData).append("title",x),s.forEach(function(e){return r.append("file",e)}),b(""),u([]),console.log("https://us-central1-realtime-chat-9abd8.cloudfunctions.net/app"),a={headers:{"content-type":"multipart/form-data; "}},e.next=9,_.Z.post("".concat("https://us-central1-realtime-chat-9abd8.cloudfunctions.net/app","/api/chat/add/").concat(n),r,a);case 9:console.log(e.sent.data);case 11:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)});return(0,m.jsxs)(g.Z,{ref:i,maxWidth:"sm",style:{position:"fixed",bottom:0,margin:"auto",left:0,right:0,background:"#ffffff"},children:[(0,m.jsx)(Z.Z,{}),(0,m.jsx)(f.Z,{children:(0,m.jsx)(v.Z,{multiline:!0,maxRows:4,fullWidth:!0,label:"メッセージを入力",margin:"normal",value:x,onChange:function(e){return b(e.target.value)}})}),(0,m.jsx)(f.Z,{display:"flex",flexDirection:"row",gap:1,flexWrap:"wrap",children:s.map(function(e,t){return(0,m.jsx)(d.Z,{icon:(0,m.jsx)(h.Z,{}),label:e.name,onDelete:function(){return u(function(t){return t.filter(function(t){return t.name!==e.name})})}},t)})}),(0,m.jsxs)(f.Z,{display:"flex",justifyContent:"space-between",sx:{mb:2},children:[(0,m.jsxs)(k.Z,{"aria-label":"attach file",component:"label",children:[(0,m.jsx)(w.Z,{}),(0,m.jsx)("input",{hidden:!0,multiple:!0,onChange:function(e){console.log(e.target.files),Array.from(e.target.files).forEach(function(e){return u(function(t){return[].concat((0,r.Z)(t),[e])})})},type:"file"})]}),(0,m.jsx)(k.Z,{"aria-label":"send",onClick:j,children:(0,m.jsx)(y.Z,{})})]})]})}function E(){var e=(0,l.useState)([]),t=e[0],n=e[1],i=(0,l.useState)(20),f=i[0],d=i[1],p=(0,l.useRef)(),h=(0,s.useRouter)();return(0,l.useEffect)(function(){(e=(0,a.Z)(c().mark(function e(){var t;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(h.isReady){e.next=2;break}return e.abrupt("return");case 2:t=(0,u.query)((0,u.collection)(o.db,"chats",h.query.id,"msgs"),(0,u.orderBy)("created","desc"),(0,u.limit)(50)),(0,u.onSnapshot)(t,function(e){n([]),e.docs.reverse().forEach(function(e){n(function(t){return[].concat((0,r.Z)(t),[e.data()])})})});case 4:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})();var e,t=new ResizeObserver(function(){d(p.current.clientHeight/8+2),console.log(p.current.clientHeight)});return t.observe(p.current),function(){return t.disconnect()}},[h]),(0,l.useEffect)(function(){window.scrollTo(0,document.body.scrollHeight)},[t]),(0,m.jsxs)("div",{children:[(0,m.jsxs)(g.Z,{maxWidth:"sm",sx:{pb:f},children:[(0,m.jsxs)("h1",{children:["CHAT ",h.query.id]}),(0,m.jsx)(j.Z,{display:"flex",flexDirection:"column",gap:2,children:t.map(function(e,t){return(0,m.jsx)(b,{msg:e},t)})})]}),(0,m.jsx)(R,{id:h.query.id,inputBoxRef:p})]})}},8557:function(e,t,n){"use strict";var r=n(5877),a=n(5503),i=r(n(6837)),c=n(6257),o=n(1153),s=(0,a.initializeApp)(i.default),u=(0,c.getFirestore)(s);e.exports.db=u,(0,o.getStorage)(s)},813:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return n(5493)}])},6837:function(e){"use strict";e.exports=JSON.parse('{"apiKey":"AIzaSyAoEyB4sn_lX0LUKGwaSO2kH5_jZcVfjOU","authDomain":"realtime-chat-9abd8.firebaseapp.com","databaseURL":"https://realtime-chat-9abd8-default-rtdb.firebaseio.com","projectId":"realtime-chat-9abd8","storageBucket":"realtime-chat-9abd8.appspot.com","messagingSenderId":"269952960831","appId":"1:269952960831:web:ada45ab1bb8c48a8382b8a"}')}},function(e){e.O(0,[16,769,774,888,179],function(){return e(e.s=813)}),_N_E=e.O()}]);